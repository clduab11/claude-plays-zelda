<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Plays Zelda - Dashboard</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00ff88, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            color: #888;
            margin-top: 10px;
        }

        .status-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.active { background: #00ff88; }
        .status-dot.inactive { background: #ff4444; animation: none; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .card h3 {
            font-size: 1rem;
            color: #00d4ff;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #00ff88;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
        }

        .hearts {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .heart {
            font-size: 1.5rem;
        }

        .heart.full { color: #ff4444; }
        .heart.empty { color: #444; }

        .action-display {
            padding: 15px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 10px;
            text-align: center;
        }

        .action-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00d4ff;
        }

        .action-reasoning {
            margin-top: 10px;
            font-style: italic;
            color: #aaa;
            font-size: 0.9rem;
        }

        .objective-display {
            padding: 15px;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 10px;
            text-align: center;
        }

        .objective-text {
            color: #00ff88;
            font-weight: bold;
        }

        .event-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .event-item {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
        }

        .event-item:last-child {
            border-bottom: none;
        }

        .event-time {
            color: #666;
            font-size: 0.8rem;
        }

        .event-type {
            font-weight: bold;
            color: #00d4ff;
        }

        .decision-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .decision-item {
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border-left: 3px solid #00d4ff;
        }

        .decision-action {
            font-weight: bold;
            color: #00ff88;
        }

        .chart-container {
            height: 200px;
            margin-top: 15px;
        }

        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 20px;
            color: #666;
        }

        .footer a {
            color: #00d4ff;
            text-decoration: none;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 212, 255, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 212, 255, 0.8);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Claude Plays Zelda</h1>
            <p class="subtitle">AI Agent Dashboard - Real-time Monitoring</p>
        </div>

        <div class="status-bar">
            <div class="status-indicator">
                <span class="status-dot" id="connectionStatus"></span>
                <span id="connectionText">Connecting...</span>
            </div>
            <div class="status-indicator">
                <span>‚è±Ô∏è Uptime: <span id="uptime">0:00:00</span></span>
            </div>
            <div class="status-indicator">
                <span>üìä FPS: <span id="fps">0</span></span>
            </div>
        </div>

        <div class="grid">
            <!-- Game State -->
            <div class="card">
                <h3>‚ù§Ô∏è Health & Resources</h3>
                <div class="hearts" id="heartsDisplay">
                    <!-- Hearts will be inserted here -->
                </div>
                <div class="stats-grid" style="margin-top: 15px;">
                    <div class="stat-item">
                        <div class="stat-value" id="rupees">0</div>
                        <div class="stat-label">üíé Rupees</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="enemies">0</div>
                        <div class="stat-label">‚öîÔ∏è Enemies</div>
                    </div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="card">
                <h3>üìä Statistics</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="deaths">0</div>
                        <div class="stat-label">üíÄ Deaths</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="decisions">0</div>
                        <div class="stat-label">ü§ñ Decisions</div>
                    </div>
                </div>
            </div>

            <!-- Current Action -->
            <div class="card">
                <h3>üéØ Current Action</h3>
                <div class="action-display">
                    <div class="action-name" id="currentAction">Initializing...</div>
                    <div class="action-reasoning" id="actionReasoning">
                        Waiting for AI decision...
                    </div>
                </div>
            </div>

            <!-- Objective -->
            <div class="card">
                <h3>üéØ Current Objective</h3>
                <div class="objective-display">
                    <div class="objective-text" id="objective">
                        Starting adventure...
                    </div>
                </div>
            </div>

            <!-- Recent Decisions -->
            <div class="card">
                <h3>ü§ñ Recent Decisions</h3>
                <div class="decision-list" id="decisionList">
                    <!-- Decisions will be inserted here -->
                </div>
            </div>

            <!-- Event Log -->
            <div class="card">
                <h3>üìú Event Log</h3>
                <div class="event-list" id="eventList">
                    <!-- Events will be inserted here -->
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Powered by Claude AI | <a href="https://github.com/clduab11/claude-plays-zelda" target="_blank">GitHub</a></p>
        </div>
    </div>

    <script>
        // Connect to WebSocket
        const socket = io();
        let startTime = Date.now();
        let isConnected = false;

        // Connection handlers
        socket.on('connect', () => {
            isConnected = true;
            updateConnectionStatus(true);
            console.log('Connected to server');
            socket.emit('request_state');
        });

        socket.on('disconnect', () => {
            isConnected = false;
            updateConnectionStatus(false);
            console.log('Disconnected from server');
        });

        // State update handler
        socket.on('state_update', (data) => {
            updateDashboard(data);
        });

        // Decision handler
        socket.on('decision', (data) => {
            addDecision(data);
            updateCurrentAction(data.decision || data);
        });

        // Event handler
        socket.on('event', (data) => {
            addEvent(data);
        });

        // Update functions
        function updateConnectionStatus(connected) {
            const dot = document.getElementById('connectionStatus');
            const text = document.getElementById('connectionText');

            if (connected) {
                dot.className = 'status-dot active';
                text.textContent = 'Connected';
            } else {
                dot.className = 'status-dot inactive';
                text.textContent = 'Disconnected';
            }
        }

        function updateDashboard(state) {
            // Update hearts
            updateHearts(state.hearts || {});

            // Update stats
            document.getElementById('rupees').textContent = state.rupees || 0;
            document.getElementById('deaths').textContent = state.deaths || 0;
            document.getElementById('enemies').textContent = state.enemies_defeated || 0;
            document.getElementById('decisions').textContent = (state.decisions || []).length;

            // Update objective
            if (state.current_objective) {
                document.getElementById('objective').textContent = state.current_objective;
            }

            // Update action
            if (state.current_action) {
                document.getElementById('currentAction').textContent = state.current_action;
            }
        }

        function updateHearts(hearts) {
            const container = document.getElementById('heartsDisplay');
            const current = hearts.current_hearts || 0;
            const max = hearts.max_hearts || 3;

            let html = '';
            for (let i = 0; i < max; i++) {
                const heartClass = i < current ? 'full' : 'empty';
                html += `<span class="heart ${heartClass}">‚ù§Ô∏è</span>`;
            }
            container.innerHTML = html;
        }

        function updateCurrentAction(decision) {
            document.getElementById('currentAction').textContent = decision.action || 'unknown';
            document.getElementById('actionReasoning').textContent =
                (decision.reasoning || 'No reasoning provided').substring(0, 150);
        }

        function addDecision(data) {
            const list = document.getElementById('decisionList');
            const decision = data.decision || data;
            const time = new Date(data.timestamp || Date.now()).toLocaleTimeString();

            const item = document.createElement('div');
            item.className = 'decision-item';
            item.innerHTML = `
                <div class="decision-action">${decision.action || 'unknown'}</div>
                <div style="font-size: 0.8rem; color: #888; margin-top: 5px;">
                    ${(decision.reasoning || '').substring(0, 100)}
                </div>
                <div class="event-time">${time}</div>
            `;

            list.insertBefore(item, list.firstChild);

            // Keep only last 20 decisions
            while (list.children.length > 20) {
                list.removeChild(list.lastChild);
            }
        }

        function addEvent(data) {
            const list = document.getElementById('eventList');
            const time = new Date(data.timestamp || Date.now()).toLocaleTimeString();

            const item = document.createElement('div');
            item.className = 'event-item';
            item.innerHTML = `
                <span class="event-type">${data.type || 'event'}</span>
                <span class="event-time"> - ${time}</span>
            `;

            list.insertBefore(item, list.firstChild);

            // Keep only last 30 events
            while (list.children.length > 30) {
                list.removeChild(list.lastChild);
            }
        }

        // Update uptime every second
        setInterval(() => {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const hours = Math.floor(elapsed / 3600);
            const minutes = Math.floor((elapsed % 3600) / 60);
            const seconds = elapsed % 60;
            document.getElementById('uptime').textContent =
                `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);

        // Request state every 5 seconds
        setInterval(() => {
            if (isConnected) {
                socket.emit('request_state');
            }
        }, 5000);
    </script>
</body>
</html>
